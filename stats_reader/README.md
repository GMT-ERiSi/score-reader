# Stats Reader for Star Wars Squadrons

This module processes Star Wars Squadrons match data into a SQLite database and generates statistics reports.

## Prerequisites

- Python 3.6+
- The JSON data file generated by the `score_extractor.season_processor` module

## Installation

1. Place the `stats_reader` directory in your project folder
2. Ensure you have the required dependencies (standard library only)

## Usage

### Workflow Overview

The recommended workflow is:

1. Extract match data from screenshots
2. Clean the extracted data to fix any AI recognition errors
3. Process the cleaned data into the database
4. View the generated stats reports

### Data Cleaning

Before processing the data, it's recommended to verify and clean it using the data cleaner:

```bash
python -m stats_reader clean --input Screenshots/all_seasons_data.json --output Screenshots/all_seasons_data_cleaned.json
```

This interactive tool will:
1. Display each match one-by-one for review
2. Allow you to edit match results, player names, and stats
3. Save a cleaned version of the data file

### Processing Data

After cleaning, process the data into the database:

```bash
python -m stats_reader process --input Screenshots/all_seasons_data_cleaned.json
```

This will:
1. Read the cleaned data file
2. Create a SQLite database (`squadrons_stats.db`)
3. Prompt you for team names for each match
4. Generate statistics reports in the `stats_reports` directory

For backward compatibility, you can also run:

```bash
python -m stats_reader --input Screenshots/all_seasons_data_cleaned.json
```

### Finding the Data File

The `all_seasons_data.json` file is typically stored in one of these locations:
- `Screenshots/all_seasons_data.json` (default location)
- `score_extractor/Screenshots/all_seasons_data.json`
- The directory where you ran the season processor

If you're unsure where your file is located, check these locations or search for "all_seasons_data.json" in your project directory.

### Generate Reports Only

If you already have a database and just want to regenerate the reports:

```bash
python -m stats_reader process --generate-only --db path/to/database.db
```

## Database Schema

The SQLite database contains the following tables:

- `seasons`: League/season information
- `teams`: Team names with win/loss records
- `matches`: Individual match records with winner information
- `players`: Player identification with consistent hashing
- `player_stats`: Detailed per-match player statistics

## Reports Generated

The module generates the following JSON reports:

1. `team_standings.json`: Win/loss records for all teams
2. `player_performance.json`: Detailed player statistics
3. `faction_win_rates.json`: Win percentages for IMPERIAL vs REBEL
4. `season_summary.json`: Match counts by season
5. `player_teams.json`: History of which players played for which teams

## Example Complete Workflow

1. Extract match data from screenshots:
   ```bash
   python -m score_extractor.season_processor
   ```

2. Clean the extracted data:
   ```bash
   python -m stats_reader clean --input Screenshots/all_seasons_data.json --output Screenshots/all_seasons_data_cleaned.json
   ```

3. Process the cleaned data into the database:
   ```bash
   python -m stats_reader process --input Screenshots/all_seasons_data_cleaned.json
   ```

4. View the generated reports in the `stats_reports` directory