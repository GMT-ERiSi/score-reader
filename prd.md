# **Project Requirements Document: Star Wars Squadrons Score Reader**

The following table outlines the detailed functional requirements of the Star Wars Squadrons Score Reader project, based on the information provided in the project's README files.

| Requirement ID | Description                                      | User Story                                                                                                   | Expected Behavior/Outcome                                                                                                                                                              |
|-----------------|--------------------------------------------------|--------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Score Extraction** |                                                  |                                                                                                              |                                                                                                                                                                                        |
| FR001          | Extract Match Data from Screenshots              | As a user, I want to automatically extract match details (scores, players, teams, factions, map, duration) from game screenshots (PNG/JPG) so I don't have to manually record them. | The system should process image files and identify relevant game data using AI vision, outputting structured data.                                                                       |
| FR002          | Process Screenshots by Season/Folder           | As a user, I want to process screenshots organized into specific folders (e.g., by season or for testing) so I can manage data extraction incrementally. | The system should allow specifying a base directory and optionally a specific season/subfolder to process, limiting extraction to the specified scope.                               |
| FR003          | Save Extracted Data to JSON                      | As a user, I want the extracted data to be saved in a structured JSON format so it can be easily used by other tools or reviewed. | The system should generate JSON files containing the extracted data, potentially creating both per-folder/season files and a combined file (`all_seasons_data.json`).                 |
| **Data Cleaning** |                                                  |                                                                                                              |                                                                                                                                                                                        |
| FR004          | Interactive Data Cleaning Tool                   | As a user, I want an interactive tool to review and correct potential AI extraction errors (scores, team names, results) by comparing extracted data against the original screenshots. | The system should present each extracted match alongside its source screenshot, allowing the user to edit fields and confirm accuracy before saving.                                  |
| FR005          | Save Cleaned Data Separately                   | As a user, I want the cleaned/corrected data to be saved to a distinct file so the original extracted data is preserved. | The cleaning tool should output a new JSON file (e.g., `_cleaned.json`) containing the verified and potentially modified data.                                                        |
| **Reference Data Management** |                                                  |                                                                                                              |                                                                                                                                                                                        |
| FR006          | Maintain Reference Database                      | As a user, I want a central database (`squadrons_reference.db`) to store canonical team and player names so that data remains consistent across all matches. | The system should use an SQLite database to store official team and player identifiers.                                                                                                |
| FR007          | Populate Reference DB from JSON                  | As a user, I want to automatically populate the reference database with player names found in the cleaned extracted data so I have a starting point for management. | The system should provide a command to read a cleaned JSON file and add newly encountered player names to the reference database.                                                      |
| FR008          | Interactive Reference Management Tool            | As a user, I want an interactive tool to manage the reference database, allowing me to create teams, manage players, assign primary teams, and resolve duplicates. | The system should provide a command-line interface (`reference_manager.py --manage`) with menus for Team Management and Player Management.                                             |
| FR009          | Create/Manage Teams in Reference DB            | As a user managing the reference data, I want to define official team names so they can be consistently applied. | The management tool should allow adding new teams and potentially editing/deleting existing ones within the reference database.                                                        |
| FR010          | Create/Manage Players in Reference DB            | As a user managing the reference data, I want to define official player names and link them to teams so player stats are tracked correctly. | The management tool should allow adding new players, assigning them a primary team affiliation, and potentially editing/deleting them within the reference database.                     |
| FR011          | Resolve Duplicate Player Names                   | As a user managing the reference data, I want to merge different variations of a player's name (e.g., "PlayerA", "Player A") into a single canonical entry so their stats are consolidated. | The management tool should identify potential duplicates and allow the user to select variations to be merged under one official player ID, storing the variations as aliases.          |
| FR012          | Update Cleaned JSON on Duplicate Resolution    | As a user managing reference data, I want the cleaned JSON file to be updated when I resolve duplicate player names so the input data reflects the canonical names. | When player name variations are merged in the reference manager, the corresponding names in the specified `_cleaned.json` file should be updated to the canonical name.                 |
| FR013          | Manage Aliases for Teams/Players               | As a user managing reference data, I want to add known aliases for teams and players so the system can recognize variations during processing. | The management tool should allow associating alternative names (aliases) with canonical team and player entries in the reference database.                                             |
| FR014          | Import/Export Reference Data                   | As a user, I might want to backup or share the reference data, so I need the ability to export it to and import it from a file (e.g., JSON). | The reference management tool should offer options to export the current reference database contents to a file and import data from a file into the database.                             |
| **Stats Database Processing** |                                                  |                                                                                                              |                                                                                                                                                                                        |
| FR015          | Process Cleaned Data into Stats DB             | As a user, I want to process the cleaned and verified match data into a main statistics database (`squadrons_stats.db`) for analysis and reporting. | The system should provide a command (`stats_db_processor.py`) to read the cleaned JSON file and populate the SQLite stats database according to the defined schema.                     |
| FR016          | Use Reference DB for Consistency               | As a user processing data, I want the system to use the reference database to ensure player and team names are consistently identified and stored in the stats database. | During processing, the system should look up player and team names from the input JSON in the reference database and use the canonical IDs when inserting data into the stats database. |
| FR017          | Interactive Player Name Matching (Fuzzy/Alias) | As a user processing data, if a player name doesn't match an entry or alias in the reference DB, I want the system to help me resolve it interactively. | If an exact match isn't found, the system should display potential fuzzy matches from the reference DB and prompt the user to: select a match, add the name as an alias, create a new player, or skip. |
| FR018          | Cache Player Matching Decisions                | As a user processing data, I don't want to be prompted repeatedly for the same unrecognized player name during a single processing run. | The system should cache the user's decision (match, alias, create, skip) for a given unrecognized name for the duration of the current processing execution.                             |
| FR019          | Prompt for Team Names with Suggestions         | As a user processing data, I want the system to prompt me for the team names involved in each match, suggesting teams based on the players identified via the reference DB. | For each match being processed, the system should ask the user to confirm/enter the competing team names, potentially offering suggestions based on the primary team affiliations of the players in the match. |
| FR020          | Prompt for Match Type                          | As a user processing data, I want to categorize each match as 'team', 'pickup', or 'ranked' so that ELO calculations can be performed correctly for different contexts. | During the interactive processing of each match, the system should prompt the user to select the appropriate `match_type`.                                                              |
| FR021          | Store Data in Defined Schema                   | As a user, I expect the processed data to be stored in a well-defined database structure for querying and reporting. | The stats database (`squadrons_stats.db`) should contain tables like `seasons`, `teams`, `matches`, `players`, `player_stats` with appropriate columns and relationships.             |
| **Match Type Management** |                                                  |                                                                                                              |                                                                                                                                                                                        |
| FR022          | Update Existing Match Types                    | As a user, I may need to correct the `match_type` for matches already in the database, so I need a way to update them. | The system should provide a tool (`stats_db_processor.py --update-match-types`) allowing bulk or individual updates to the `match_type` field for existing records in the `matches` table. |
| **Pickup/Ranked Data Preparation** |                                                  |                                                                                                              |                                                                                                                                                                                        |
| FR023          | Prepare Player Stats for Player ELO            | As a user wanting to calculate player-specific ELO for pickup/ranked games, I need to ensure player stats are not linked to the match's temporary team IDs for these game types. | The system must provide a script (`fix_pickup_team_ids.py`) that sets `player_stats.team_id` to NULL for records associated with matches where `match_type` is 'pickup' or 'ranked'. |
| **ELO Calculation & Ladder Generation** |                                                  |                                                                                                              |                                                                                                                                                                                        |
| FR024          | Calculate ELO Ratings                          | As a user, I want the system to calculate ELO ratings based on match outcomes to rank teams and/or players by skill. | The system should implement the ELO algorithm, processing matches chronologically and adjusting ratings based on actual vs. expected outcomes.                                         |
| FR025          | Support Multiple ELO Ladder Types              | As a user, I want separate ELO rankings for organized teams, pickup game players, and ranked queue players, reflecting performance in different contexts. | The system should calculate and generate distinct ELO ladders based on `match_type`: 'team' (team ELO), 'pickup' (player ELO), 'ranked' (player ELO).                                |
| FR026          | Configure ELO Parameters                       | As a user, I might want to adjust the ELO calculation parameters, such as the starting ELO and K-factor. | The ELO calculation script (`elo_ladder.py`) should accept command-line arguments to set the starting ELO value and the K-factor.                                                    |
| FR027          | Generate ELO Ladder Reports (JSON)             | As a user, I want the calculated ELO rankings to be saved in easily accessible JSON files. | The system should generate `elo_ladder_team.json`, `pickup_player_elo_ladder.json`, `ranked_player_elo_ladder.json` (and potentially a combined `elo_ladder.json`) containing the final rankings. |
| FR028          | Generate ELO History Reports (JSON)            | As a user, I want to track how ELO ratings have changed over time for teams/players. | For each generated ELO ladder, the system should also create a corresponding `_history.json` file detailing the ELO changes after each relevant match.                               |
| **Reporting** |                                                  |                                                                                                              |                                                                                                                                                                                        |
| FR029          | Generate Statistical Reports                   | As a user, I want various summary reports generated from the stats database to analyze performance. | The system should generate multiple JSON reports, including team standings, player performance stats, faction win rates, season summaries, and player team history.                     |
| FR030          | Regenerate Reports from Existing DB            | As a user, if I update the data or want fresh reports, I need a way to regenerate them without reprocessing all the raw data. | The stats processing script should offer a `--generate-only` option to recreate reports using data already present in the specified stats database.                                    |